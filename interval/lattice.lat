Lattice Definition Module IntervalLattice 
model   org.inca.data.test.analyses.plugin 
package interval    imports     nothing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
Constructors: Empty | Top | Interval(long, long)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
Operations:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def bot() : IntervalLattice = { 
  return Empty; 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def top() : IntervalLattice = { 
  return Top; 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def leq(l : IntervalLattice, r : IntervalLattice) : boolean = { 
  match (l, r) with { 
    case (Empty, _) => return true; 
    case (_, Top) => return true; 
    case (Interval(l1, h1), Interval(l2, h2)) => return l2 <= l1 && h1 <= h2; 
    case _ => return false; 
  }; 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def lub(l : IntervalLattice, r : IntervalLattice) : IntervalLattice = { 
  match (l, r) with { 
    case (_, Empty) => return l; 
    case (Empty, _) => return r; 
    case (_, Top) => return r; 
    case (Top, _) => return l; 
    case (Interval(l1, h1), Interval(l2, h2)) => return widen(Interval(Math.min(l1, l2), Math.max(h1, h2))); 
  }; 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def glb(l : IntervalLattice, r : IntervalLattice) : IntervalLattice = { 
  match (l, r) with { 
    case (_, Empty) => return r; 
    case (Empty, _) => return l; 
    case (_, Top) => return l; 
    case (Top, _) => return r; 
    case (Interval(l1, h1), Interval(l2, h2)) => return widen(Interval(Math.max(l1, l2), Math.min(h1, h2))); 
  }; 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def binaryOp(l : IntervalLattice, r : IntervalLattice, op : Operation) : IntervalLattice = { 
  match (l, r) with { 
    case (_, Empty) => return l; 
    case (Empty, _) => return r; 
    case (_, Top) => return r; 
    case (Top, _) => return l; 
    case (Interval(l1, h1), Interval(l2, h2)) => switch (op) { 
        case Operation.ADD : 
          return widen(Interval(l1 + l2, h1 + h2)); 
        case Operation.SUB : 
          return widen(Interval(l1 - h2, h1 - l2)); 
        case Operation.MUL : 
          long v1 = l1 * l2; 
          long v2 = l1 * h2; 
          long v3 = h1 * l2; 
          long v4 = h1 * h2; 
          long ln = Math.min(v1, Math.min(v2, Math.min(v3, v4))); 
          long hn = Math.max(v1, Math.max(v2, Math.max(v3, v4))); 
          return widen(Interval(ln, hn)); 
        default : 
          return top(); 
      } 
  }; 
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def unaryOp(l : IntervalLattice, op : Operation, value : int) : IntervalLattice = { 
  match l with { 
    case Empty => return l; 
    case Top => return Top; 
    case Interval(lv, rv) => switch (op) { 
        case Operation.ADD : 
          return widen(Interval(lv + value, rv + value)); 
        case Operation.SUB : 
          return widen(Interval(lv - value, rv - value)); 
        default : 
          return top(); 
      } 
  }; 
}                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def widen(l : IntervalLattice) : IntervalLattice = { 
  match l with { 
    case Empty => return l; 
    case Top => return l; 
    case Interval(l1, h1) => { 
      long ln = l1 < -50 ? Integer.MIN_VALUE : l1; 
      long hn = h1 > 50 ? Integer.MAX_VALUE : h1; 
      return Interval(ln, hn); 
    } 
  }; 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
def singleton(value : int) : IntervalLattice = { 
  return widen(Interval(value, value)); 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
